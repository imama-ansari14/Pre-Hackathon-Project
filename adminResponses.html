<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <title>Survey Responses - Admin</title>
  <!--  BOOTSTRAP  -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- Supabase JS -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <!-- CUSTOM CSS -->
  <link rel="stylesheet" href="styles.css">
  <style>
    body {
      background: linear-gradient(135deg, #0f766e 0%, #14b8a6 100%);
      min-height: 100vh;
      font-family: 'Poppins', sans-serif;
    }
  </style>
</head>

<body class="bg-light">
  <div class="container py-5">

    <h2 class="page-title text-center">ðŸ“Š Survey Responses</h2>
    <div id="responsesContainer"></div>

  </div>

  <script src="app.js"></script>
  <script>if (window.location.pathname.includes("adminResponses.html")) {
      loadAdminResponses();
    }
    async function loadAdminResponses() {
      const container = document.getElementById("responsesContainer");

      const { data: responses, error } = await supabaseClient
        .from("responses")
        .select(`
            id,
            created_at,
            answers,
            surveys (
                ques1,
                ques2,
                ques3,
                ques4
            )
        `)
        .order("created_at", { ascending: false });

      if (error) {
        console.error(error);
        container.innerHTML = "<p class='text-danger'>Failed to load responses</p>";
        return;
      }

      if (responses.length === 0) {
        container.innerHTML = "<p>No responses yet.</p>";
        return;
      }

      renderAdminResponses(responses);
    }
    function renderAdminResponses(responses) {
      const container = document.getElementById("responsesContainer");
      container.innerHTML = "";

      responses.forEach((res, index) => {
        const answers = res.answers;
        const survey = res.surveys;

        const q3Answers = (answers.q3 || []).length
          ? answers.q3.join(", ")
          : "No selection";

        container.innerHTML += `
        <div class="card response-card mb-4">
          <div class="card-header response-header d-flex justify-content-between align-items-center">
            <span>Response #${index + 1}</span>
            <span class="timestamp">${new Date(res.created_at).toLocaleString()}</span>
          </div>

          <div class="card-body">
            <div>
              <div class="question text-black">${survey.ques1}</div>
              <div class="answer ${answers.q1 ? "" : "empty"}">${answers.q1 || "No answer"}</div>
            </div>

            <div>
              <div class="question text-black">${survey.ques2}</div>
              <div class="answer ${answers.q2 ? "" : "empty"}">${answers.q2 || "No answer"}</div>
            </div>

            <div>
              <div class="question text-black">${survey.ques3}</div>
              <div class="answer">${q3Answers}</div>
            </div>

            <div>
              <div class="question text-black">${survey.ques4}</div>
              <div class="answer ${answers.q4 ? "" : "empty"}">${answers.q4 || "No answer"}</div>
            </div>
          </div>
        </div>
        `;
      });
    }

  </script>

</body>

</html>